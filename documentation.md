# üìò Templater API Documentation

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### `GET /start_auth`
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å OAuth-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å Google.

**–û—Ç–≤–µ—Ç:**
```json
{ "auth_url": "https://..." }
```

---

### `GET /oauth_callback?state=...&code=...`
–ó–∞–≤–µ—Ä—à–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Google –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω.

- –£—Å–ø–µ—Ö: —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/templates`
- –û—à–∏–±–∫–∞: `400`, –µ—Å–ª–∏ `state` –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

## üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏

### `GET /templates`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —à–∞–±–ª–æ–Ω–æ–≤.

–®–∞–±–ª–æ–Ω: `templates.jinja2`

---

### `GET /add_template`
–§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞.

–®–∞–±–ª–æ–Ω: `add_template.jinja2`

---

### `POST /api/add_template`
–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω",
  "template": { ... }
}
```

---

### `GET /edit_template/{template_id}`
HTML-—Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞.

–®–∞–±–ª–æ–Ω: `edit_template.jinja2`

---

### `POST /edit_template/{template_id}`
–û–±–Ω–æ–≤–ª—è–µ—Ç –∏–º—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É.

–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/templates`

---

### `POST /api/update_template/{template_id}`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø–æ API.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "name": "–ù–æ–≤–æ–µ –∏–º—è",
  "description": "–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{ "message": "–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω" }
```

---

### `POST /delete_template/{template_id}`
–£–¥–∞–ª—è–µ—Ç –æ–¥–∏–Ω —à–∞–±–ª–æ–Ω.

**–û—Ç–≤–µ—Ç:**
```json
{ "message": "–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω" }
```

---

### `GET /delete_templates`
–§–æ—Ä–º–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤.

–®–∞–±–ª–æ–Ω: `delete_templates.jinja2`

---

### `POST /delete_templates`
–£–¥–∞–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω–æ–≤.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "selected_templates": ["1", "2", "3"]
}
```

**–û—Ç–≤–µ—Ç:**
```json
{ "message": "–®–∞–±–ª–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã" }
```

---

## üßæ –í–≤–æ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞

### `GET /input_template_data/{template_id}`
–§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

–®–∞–±–ª–æ–Ω: `input_data_template.jinja2`

---

### `POST /api/save_template_data/{template_id}`
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "data": {
    "field_1": { "label": "–ò–º—è", "value": "–ò–≤–∞–Ω" },
    "field_2": { "label": "–§–∞–º–∏–ª–∏—è", "value": "–ü–µ—Ç—Ä–æ–≤" }
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{ "message": "–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã" }
```

---

### `GET /api/get_template_data_status/{template_id}`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–û—Ç–≤–µ—Ç:**
```json
{ "has_data": true }
```

---

## üì§ –≠–∫—Å–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–æ–≤

### `POST /export_template/{template_id}`
–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –∫–∞–∫ `.txt` –≤ Google Drive.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{ "folder_id": "GoogleDriveFolderID" }
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ Google Drive",
  "file_id": "..."
}
```

---

### `POST /export_archive_to_drive`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞—Ä—Ö–∏–≤ –≤ Google Drive –∏–∑ GridFS.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{ "file_id": "<id —Ñ–∞–π–ª–∞ –≤ GridFS>" }
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Google Drive",
  "file_id": "..."
}
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### `POST /verify`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —à–∞–±–ª–æ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã—Ö.

**–§–æ—Ä–º–∞ POST (multipart):**
- `template-id`: ID —à–∞–±–ª–æ–Ω–∞
- `data-table-id`: ID —Ñ–∞–π–ª–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "OK",
  "messages": ["Field X not defined in CSV"],
  "fields": ["–∏–º—è", "—Ñ–∞–º–∏–ª–∏—è", ...]
}
```

---

### `POST /render`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç(—ã) –ø–æ —à–∞–±–ª–æ–Ω—É –∏ –¥–∞–Ω–Ω—ã–º.

**–§–æ—Ä–º–∞ POST (multipart):**
- `template-id`
- `data-table-id`
- `name-pattern` (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –∏–º–µ–Ω–∏)

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "OK",
  "files": {
    "–∏–º—è1.docx": "<id>",
    "–∏–º—è2.docx": "<id>"
  },
  "archive": "<id –∞—Ä—Ö–∏–≤–∞>",
  "archive_name": "—à–∞–±–ª–æ–Ω.zip"
}
```

---

## üìÅ –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

### `POST /upload`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –≤ GridFS.

**–§–æ—Ä–º–∞:**
- `file`: —Ñ–∞–π–ª
- `table-preview`: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "OK",
  "file_name": "filename.docx",
  "file_id": "ObjectId",
  "expire_at": "2024-10-01T12:00:00"
}
```

---

### `GET /files?file_id=<id>`
–°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –∏–∑ GridFS.

- –ö–æ–Ω—Ç–µ–Ω—Ç: `application/vnd.oasis.opendocument.text`
- –°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Disposition: attachment`

---

## üåç –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### `GET /`
–í—ã–≤–æ–¥–∏—Ç CAPTCHA-–ø—Ä–æ–≤–µ—Ä–∫—É —Å –≤—ã–±–æ—Ä–æ–º —Ä–æ–ª–∏ (`admin` –∏–ª–∏ `user`).

–®–∞–±–ª–æ–Ω: `verify_captcha.jinja2`

---

### `GET /locale?language=ru`
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —è–∑—ã–∫–æ–≤—É—é –∫—É–∫—É `_LOCALE_`.

–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä.

---

### `GET /user_home`
–î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–®–∞–±–ª–æ–Ω: `user_home.jinja2`

---

### `GET /home`
–î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

–®–∞–±–ª–æ–Ω: `homepage.jinja2`

---

### `GET /dis`
–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É DIS –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `DIS_URL`.

---

## üß± –°—Ç–∞—Ç–∏–∫–∞

–°–ª–µ–¥—É—é—â–∏–µ –ø—É—Ç–∏ –æ—Ç–¥–∞—é—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã:

```
/static/css
/static/js
/static/img
/ViewerJS
```

